<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd">
    
    <bean  id="setHeader_" class="de.baumarktdirekt.servicemix.aggregate.SetHeaderAggregationStrategy">
        <argument value="location_dest_id"/>
    </bean>

    <camelContext xmlns="http://camel.apache.org/schema/blueprint">
        
        <route id="direct:create.stock.picking-start">
            <from id="start" uri="direct:start" />
            <log id="_log3" message="- Sent -"/>
            <setHeader headerName="Content-Typ">
                <constant>text/xml; charset=utf-8</constant>        
            </setHeader>
            <to uri="stream:out" />
        </route>
        
        <route id="lookup.stock.location">
            <from uri="direct:lookup.stock.location" />
            <setHeader headerName="odoo-model">
                <constant>stock.location</constant>        
            </setHeader>
            <setHeader headerName="odoo-filter">
                <constant>name ilike 490%</constant>        
            </setHeader>            
            <to uri="direct:lookup" /> 
        </route>
        
        <route id="lookup">
            <from uri="direct:lookup" />
            <setHeader headerName="Content-Typ">
                <constant>text/xml; charset=utf-8</constant>        
            </setHeader>
            <setHeader headerName="odoo-database">
                <constant>bmd</constant>        
            </setHeader>
            <setHeader headerName="odoo-userid">
                <constant>1</constant>
            </setHeader>            
            <setHeader headerName="odoo-password">
                <constant>Odoo</constant>        
            </setHeader>
            <to id="_to1" uri="xslt:xslt/odoo-lookup.xslt?saxon=true"/>
            <to uri="stream:out" />
            <to uri="https4://ntw-node-test01.bmd.local/xmlrpc/2/object" />
            <to uri="stream:out" />
            <setBody> 
                <xpath>/methodResponse/params/param/array/data/value/int</xpath>
            </setBody>
        </route>
        
        
    </camelContext>

</blueprint>
